<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Karta wizyty pacjenta</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <!-- FileSaver.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- html-docx-js -->
  <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-4">
  <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
    <div class="p-6">
      <!-- Nagłówek -->
      <header class="flex flex-col md:flex-row items-center mb-6">
        <img src="logo_szpitala.png" alt="Logo szpitala" class="h-24 mr-6 mb-4 md:mb-0">
        <div class="text-center md:text-left">
          <h2 class="text-3xl font-bold">Klinika Kardiologii z Pododdziałem Ostrych Zespołów Wieńcowych</h2>
          <p class="mt-1 text-lg">Kliniczny Szpital Wojewódzki Nr 2 im. Św. Jadwigi Królowej w Rzeszowie</p>
          <p class="text-sm text-gray-600">ul. Lwowska 60, 35-301 Rzeszów</p>
        </div>
      </header>

      <h1 class="text-2xl md:text-3xl font-semibold text-center mb-2">Karta wizyty pacjenta</h1>
      <!-- Wyświetlana nazwa pacjenta -->
      <p id="displayName" class="text-lg font-medium text-center mb-8">Pacjent: —</p>

      <form id="visitForm" class="space-y-6">
        <!-- 1. Dane pacjenta -->
        <fieldset class="border p-4 rounded">
          <legend class="font-semibold">1. Dane pacjenta</legend>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
            <label class="block text-sm">Imię i nazwisko<br>
              <input name="patientName" type="text" class="mt-1 w-full border rounded p-2" required>
            </label>
            <label class="block text-sm">PESEL / ID pacjenta<br>
              <input name="patientID" type="text" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">Wiek<br>
              <input name="patientAge" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">Data wizyty<br>
              <input name="visitDate" type="date" class="mt-1 w-full border rounded p-2">
            </label>
          </div>
        </fieldset>

        <!-- 2. Kontrola kardiostymulatora -->
        <fieldset class="border p-4 rounded">
          <legend class="font-semibold">2. Kontrola kardiostymulatora</legend>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2">
            <label class="block text-sm">Bateria [%]<br>
              <input name="batteryPercent" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">ERI [%]<br>
              <input name="ERI" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">Vp [%]<br>
              <input name="VpPercent" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">Sensing [mV]<br>
              <input name="sensing" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">Pacing threshold [V]<br>
              <input name="pacingThreshold" type="number" step="0.01" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">Impedancja [Ω]<br>
              <input name="impedance" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">Tryb pracy<br>
              <input name="pmMode" type="text" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">EKG<br>
              <textarea name="EKG" rows="2" class="mt-1 w-full border rounded p-2"></textarea>
            </label>
          </div>
        </fieldset>

        <!-- 3. Jakość życia i Test PASAT -->
        <fieldset class="border p-4 rounded">
          <legend class="font-semibold">3. Jakość życia i Test PASAT</legend>
          <label class="block text-sm mt-2">Ocena jakości życia (EQ-5D-5L)<br>
            <input name="EQ5D" type="text" class="mt-1 w-full border rounded p-2">
          </label>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
            <label class="block text-sm">HR PASAT baseline [/min]<br>
              <input name="PASAT_HR_baseline" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">HR PASAT end [/min]<br>
              <input name="PASAT_HR_end" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">RR PASAT baseline [mmHg]<br>
              <input name="PASAT_RR_baseline" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">RR PASAT end [mmHg]<br>
              <input name="PASAT_RR_end" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">% poprawnych odpowiedzi<br>
              <input name="PASAT_percentCorrect" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">SpO₂ [%]<br>
              <input name="SpO2" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
          </div>
        </fieldset>

        <!-- 4. Handgrip Test -->
        <fieldset class="border p-4 rounded">
          <legend class="font-semibold">4. Handgrip Test</legend>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mt-2">
            <label class="block text-sm">Wyjściowo (kg)<br>
              <input name="handgripBaseline" type="number" step="0.1" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">HR początkowy [/min]<br>
              <input name="handgripHR_baseline" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">RR początkowy [mmHg]<br>
              <input name="handgripRR_baseline" type="number" class="mt-1 w-full border rounded p-2">
            </label>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 mt-4">
            <label class="block text-sm">HR po 1 min<br>
              <input name="handgripHR_1min" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">HR po 2 min<br>
              <input name="handgripHR_2min" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">HR po 3 min<br>
              <input name="handgripHR_3min" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">HR po 4 min<br>
              <input name="handgripHR_4min" type="number" class="mt-1 w-full border rounded p-2">
            </label>
            <label class="block text-sm">HR po 5 min<br>
              <input name="handgripHR_5min" type="number" class="mt-1 w-full border rounded p-2">
            </label>
          </div>
        </fieldset>

                
        <!-- 5. Ocena zastawek -->
        <fieldset class="border p-4 rounded space-y-6">
          <legend class="font-semibold">5. Ocena zastawek</legend>
          <!-- Mitralna -->
          <div>
            <h3 class="font-semibold mb-2">5.1 Mitralna</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <label class="block text-sm">Niedomykalność<br>
                <select name="mitralRegurg" class="mt-1 w-full border rounded p-2">
                  <option value="">–</option><option>łagodna</option><option>umiarkowana</option><option>średni</option>
                </select>
              </label>
              <label class="block text-sm">Stenoza<br>
                <select name="mitralStenosis" class="mt-1 w-full border rounded p-2">
                  <option value="">–</option><option>łagodna</option><option>umiarkowana</option><option>ciężka</option>
                </select>
              </label>
            </div>
          </div>
          <!-- Aortalna -->
          <div>
            <h3 class="font-semibold mb-2">5.2 Aortalna</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <label class="block text-sm">Niedomykalność<br>
                <select name="aorticRegurg" class="mt-1 w-full border rounded p-2">
                  <option value="">–</option><option>łagodna</option><option>umiarkowana</option><option>średni</option>
                </select>
              </label>
              <label class="block text-sm">Stenoza<br>
                <select name="aorticStenosis" class="mt-1 w-full border rounded p-2">
                  <option value="">–</option><option>łagodna</option><option>umiarkowana</option><option>ciężka</option>
                </select>
              </label>
            </div>
          </div>
          <!-- Trójdzielna -->
          <div>
            <h3 class="font-semibold mb-2">5.3 Trójdzielna</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <label class="block text-sm">Niedomykalność<br>
                <select name="tricuspidRegurg" class="mt-1 w-full border rounded p-2">
                  <option value="">–</option><option>łagodna</option><option>umiarkowana</option><option>średni</option>
                </select>
              </label>
              <label class="block text-sm">Stenoza<br>
                <select name="tricuspidStenosis" class="mt-1 w-full border rounded p-2">
                  <option value="">–</option><option>łagodna</option><option>umiarkowana</option><option>ciężka</option>
                </select>
              </label>
            </div>
          </div>
        </fieldset>

        <!-- Eksport -->
        <div class="flex space-x-4 pt-4">
          <button type="button" id="exportCsv" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
            Eksportuj CSV
          </button>
          <button type="button" id="exportDocx" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
            Eksportuj DOCX
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Dynamiczne pola wymiarów
    const dimsList = [
      'LVEDD [mm]', 'LVESD [mm]', 'LA [mm]', 'LAVI [ml/m2]', 
      'IVS [mm]', 'PW [mm]', 'RVOT [mm]'
    ];
    const dimsContainer = document.getElementById('dims');
    dimsList.forEach(label => {
      const wrap = document.createElement('label');
      wrap.className = 'block text-sm';
      wrap.innerHTML = `${label}<br>
        <input name="${label}" type="number" step="0.1" class="mt-1 w-full border rounded p-2">`;
      dimsContainer.appendChild(wrap);
    });

    // ... dalej bez zmian ...
  </script>
</body>
</html>
